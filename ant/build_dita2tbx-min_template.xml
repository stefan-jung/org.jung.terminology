<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:if="ant:if" xmlns:unless="ant:unless">
    
    <target name="dita2tbx-min"
        depends="tbx-min.init,
        preprocess,
        dita.topics.html.tbx-min"/>
    
    <target name="tbx-min.init">
        <property name="root-chunk-override" value="to-content"/>
    </target>
    
    <target name="dita.topics.html.tbx-min" description="Build XHTML output from dita inner and outer topics,which will adjust the directory.">
        <pipeline>
            <xslt 
                destdir="${output.dir}"
                reloadstylesheet="${dita.xhtml.reloadstylesheet}"
                extension=".tbxm"
                style="${dita.plugin.org.jung.terminology.dir}/xsl/tbx-min/tbx-min.xsl">
                <ditafileset format="dita" processingRole="normal"/>
                <param name="sourceLanguage" expression="${args.source.language}" if="args.source.language"/>
                <param name="targetLanguage" expression="${args.target.language}" if="args.target.language"/>
                <xmlcatalog refid="dita.catalog"/>
            </xslt>
        </pipeline>
        <basename property="tbx-min" file="${args.input}" suffix=".ditamap"/>
        <delete>
            <fileset dir="${output.dir}" >
                <exclude name="**/${tbx-min}.tbxm"/>
            </fileset>
            <dirset dir="${output.dir}"/>
        </delete>
        <copy file="${dita.plugin.org.jung.terminology.dir}${file.separator}dtd${file.separator}TBX-Min.rng" todir="${output.dir}"/>
        <replaceregexp file="${output.dir}${file.separator}${tbx-min}.tbxm" match="&lt;!DOCTYPE TBX\s+PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;" replace=""/>
    </target>
    
</project>