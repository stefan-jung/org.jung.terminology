<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:if="ant:if" xmlns:unless="ant:unless">
    
    <target name="dita2termchecker-dita"
        depends="termchecker-dita.init,
        html5.init,
        build-init,
        preprocess,
        termchecker-dita.create-schematron"/>
    
    <target name="termchecker-dita.init">
        <property name="root-chunk-override" value="to-content"/>
        <condition property="args.language" value="en-GB">
            <not>
                <isset property="args.language"/>
            </not>
        </condition>
    </target>
    
    <target name="termchecker-dita.create-schematron" description="Create a Schematron termchecker for XLIFF">
        <pipeline>
        <xslt 
            destdir="${output.dir}"
            reloadstylesheet="${dita.xhtml.reloadstylesheet}"
            extension="-DITA-${args.language}.sch"
            style="${dita.plugin.org.jung.terminology.dir}/xsl/terminology2termchecker-dita.xsl">
            <ditafileset format="dita" processingRole="normal"/>
            <param name="language" expression="${args.language}" if="args.language"/>
            <xmlcatalog refid="dita.catalog"/>
        </xslt>
        </pipeline>
        <basename property="schematronFile" file="${args.input}" suffix=".ditamap"/>
        <delete>
            <fileset dir="${output.dir}" >
                <exclude name="**/${schematronFile}*.sch"/>
            </fileset>
            <dirset dir="${output.dir}"/>
        </delete>
        <!-- Replace conflicting DOCTYPE declarations -->
        <replaceregexp match="&lt;!DOCTYPE[\s\S]*dtd&quot;[\s]*&gt;" replace="" byline="false">
            <fileset dir="${output.dir}">
                <include name="**/${schematronFile}*.sch"/>
            </fileset>
        </replaceregexp>
    </target>
    
</project>
