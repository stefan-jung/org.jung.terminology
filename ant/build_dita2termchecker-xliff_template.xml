<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:if="ant:if" xmlns:unless="ant:unless">
    
    <target name="dita2termchecker-xliff"
        depends="termchecker-xliff.init,
        html5.init,
        build-init,
        preprocess,
        termchecker-xliff.create-schematron"/>
    
    <target name="termchecker-xliff.init">
        <property name="root-chunk-override" value="to-content"/>
        <condition property="args.language" value="en-GB">
            <not>
                <isset property="args.language"/>
            </not>
        </condition>
    </target>
    
    <target name="termchecker-xliff.create-schematron" description="Create a Schematron termchecker for XLIFF">
        <pipeline>
            <xslt 
                destdir="${output.dir}"
                reloadstylesheet="${dita.xhtml.reloadstylesheet}"
                extension="-XLIFF-${args.language}.sch"
                style="${dita.plugin.org.jung.terminology.dir}/xsl/termchecker-xliff/terminology2termchecker-xliff.xsl">
                <ditafileset format="dita" processingRole="normal"/>
                <param name="language" expression="${args.language}" if="args.language"/>
                <param name="checkElements" expression="${args.check.elements}" if="args.check.elements"/>
                <xmlcatalog refid="dita.catalog"/>
            </xslt>
        </pipeline>
        <basename property="schematronFile" file="${args.input}" suffix=".ditamap"/>
        <delete>
            <fileset dir="${output.dir}" >
                <exclude name="**/${schematronFile}*.sch"/>
            </fileset>
            <dirset dir="${output.dir}"/>
        </delete>
        <!-- Replace conflicting DOCTYPE declarations -->
        <replaceregexp match="&lt;!DOCTYPE[\s\S]*dtd&quot;[\s]*&gt;" replace="" byline="false">
            <fileset dir="${output.dir}">
                <include name="**/${schematronFile}*.sch"/>
            </fileset>
        </replaceregexp>
    </target>
    
</project>
